<!-- wp:heading -->
<h2 class="wp-block-heading">前言</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>这是一个用于WordPress的附件密码下载，对接公众号 提供API 方便其他程序调用 支持多平台机器人 如 QQ官方机器人 TG机器人等 密码随机生成，支持ai大模型。程序永久免费且开源 开源地址 <a href="https://github.com/naigoucn/ngdown">https://github.com/naigoucn/ngdown</a> 前台下载样式参考 <a href="https://6ke.li/forum-post/1048.html">6KE论坛的子比下载插件</a> 微信机器人参考<a href="http://github.com/wangvsa/wechat-robot">http://github.com/wangvsa/wechat-robot</a> 和 <a href="https://github.com/shiheme/wechat-robot-guoqing">https://github.com/shiheme/wechat-robot-guoqing</a>  图标样式采用开源icon库 <a href="https://remixicon.com">remixicon</a> 发一个之前的老版本，不对接公众号的版本 下载地址 <a href="https://www.123684.com/s/uXJuVv-mN4U3">https://www.123684.com/s/uXJuVv-mN4U3</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading"><strong>支持功能</strong></h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>输入密码下载附件</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>对接微信公众号随机密码</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>公众号推送文章</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>单篇文章密码30分钟自动切换</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>对接AI大模型实现自动聊天</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>提供api接口 方便其他机器人框架调用</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>支持多平台机器人 如QQ/TG等 （取决于您的机器人框架）</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>后台设置页面 自定义回复设置 大模型设置 api密钥设置</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>自动识别网盘链接展示对应图标</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>支持选择开启或关闭密码下载</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">演示图</h2>
<!-- /wp:heading -->

<!-- wp:image {"id":772,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225111059803.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225111059803.png" alt="" class="wp-image-772"/></a></figure>
<!-- /wp:image -->

<!-- wp:image {"id":773,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225111145932.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225111145932.png" alt="" class="wp-image-773"/></a></figure>
<!-- /wp:image -->

<!-- wp:image {"id":774,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225111924815.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225111924815.png" alt="" class="wp-image-774"/></a></figure>
<!-- /wp:image -->

<!-- wp:image {"id":775,"width":"839px","height":"auto","sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full is-resized"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112358893.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112358893.png" alt="" class="wp-image-775" style="width:839px;height:auto"/></a></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 class="wp-block-heading">使用方法</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">文章页</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>新建文章后，如果想在文章底部加上密码下载就在编辑器底部找到下图设置</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":777,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112506405.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112506405.png" alt="" class="wp-image-777"/></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>填写对应内容即可，选项留空前台不显示该内容，显示选项 选择隐藏前台也不显示该内容。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">对接微信公众号</h3>
<!-- /wp:heading -->

<!-- wp:image {"id":778,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112628783.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112628783.png" alt="" class="wp-image-778"/></a></figure>
<!-- /wp:image -->

<!-- wp:image {"id":779,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112736966.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112736966.png" alt="" class="wp-image-779"/></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>在这里输入你的微信公众号 <strong>开发者ID(AppID)</strong> 和 <strong>开发者密码(AppSecret)</strong> </p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">如何获取<strong>开发者ID(AppID)</strong> 和 <strong>开发者密码(AppSecret)</strong>？</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>登录微信公众号平台 <a href="https://mp.weixin.qq.com">mp.weixin.qq.com</a> 登录账号 找到 <strong>设置与开发</strong> 点击 <strong>开发接口管理</strong> 如下图</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":686,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250209021443491.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250209021443491.png" alt="" class="wp-image-686"/></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>复制appid粘贴到上面的位置，密钥点击重置，扫码后重新获取 记得把服务器ip设置为IP白名单。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":687,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250209021622897.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250209021622897.png" alt="" class="wp-image-687"/></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>服务器地址改为 <strong>https://你的域名/?wechat </strong>token填写wechat 消息加解密方式选择明文模式。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">对接AI大模型</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>后台找到微信机器人 AI模型 按要求填写</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":780,"sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112838877.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225112838877.png" alt="" class="wp-image-780"/></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>这个适配的是openai的，大部分大模型都支持，所以改接口 改密钥 改模型代码 理论支持所有大模型，例如腾讯混元 阿里通义千问 DeepSeek等。 预装了部分ai大模型 如通义千问 腾讯混元 deepseek kimi 模型记得选择正确 不然会失败。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">API秘钥</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>插件提供api用来获取密码 采用post形式 API Token按你需要的设置。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":781,"width":"840px","height":"auto","sizeSlug":"full","linkDestination":"media"} -->
<figure class="wp-block-image size-full is-resized"><a href="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225113153321.png"><img src="https://ttimg.cn/cdn/naigou_cn/2025/02/20250225113153321.png" alt="" class="wp-image-781" style="width:840px;height:auto"/></a></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">接口请求方式</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>api_token就是你设置的token postid就是你开启密码下载的文章</p>
<!-- /wp:paragraph -->

<!-- wp:acf/zaxu-highlight-code {"name":"acf/zaxu-highlight-code","data":{"zaxu_highlight_code_language":"paintext","_zaxu_highlight_code_language":"field_5e2dc17bbbb9c","zaxu_highlight_code_content":"URL： https://域名/wp-json/ngapi/v1/get-password\r\nMethod: POST \r\nHeaders: Content-Type: application/json\r\nBody (JSON):\r\n{\r\n    \u0022api_token\u0022: \u0022your_api_token_here\u0022,\r\n    \u0022postid\u0022: your_post_id_here\r\n}","_zaxu_highlight_code_content":"field_5e2dbbd5f2c08"},"mode":"auto"} /-->

<!-- wp:heading -->
<h2 class="wp-block-heading">对接其他机器人</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">QQ机器人 </h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>我使用的是 <a href="https://github.com/Soulter/AstrBot">AstrBot 机器人框架</a> 对接的QQ官方机器人 AstrBot安装教程 和使用教程 这里就不赘述 需要的请自行前往仓库获取。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">插件代码及仓库地址</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><a href="https://github.com/naigoucn/astrbot_plugin_ngdown">https://github.com/naigoucn/astrbot_plugin_ngdown</a></p>
<!-- /wp:paragraph -->

<!-- wp:acf/zaxu-highlight-code {"name":"acf/zaxu-highlight-code","data":{"zaxu_highlight_code_language":"paintext","_zaxu_highlight_code_language":"field_5e2dc17bbbb9c","zaxu_highlight_code_content":"from astrbot.api.event import filter, AstrMessageEvent, MessageEventResult\r\nfrom astrbot.api.star import Context, Star, register\r\nfrom astrbot.api import logger\r\nimport requests\r\n\r\n@register(\u0022article_password\u0022, \u0022奶狗\u0022, \u0022奶狗WordPress文章密码下载插件\u0022, \u00221.0.0\u0022, \u0022repo url\u0022)\r\nclass ArticlePasswordPlugin(Star):\r\n    def __init__(self, context: Context):\r\n        super().__init__(context)\r\n        self.api_token = \u0022966877\u0022  # 在这里配置 API Token\r\n        self.website_url = \u0022https://www.naigou.cn\u0022  # 在这里配置网站 URL后面不要加/\r\n    \r\n    # 注册指令的装饰器。指令名为 文章密码。注册成功后，发送 `/文章密码 xxx` 就会触发这个指令，并回复 密码信息\r\n    @filter.command(\u0022文章密码\u0022)\r\n    async def article_password(self, event: AstrMessageEvent):\r\n        '''这是一个获取文章密码的指令''' # 这是 handler 的描述，将会被解析方便用户了解插件内容。建议填写。\r\n        user_name = event.get_sender_name()\r\n        message_str = event.message_str.strip() # 用户发的纯文本消息字符串\r\n        \r\n        # 解析命令参数\r\n        parts = message_str.split(maxsplit=1)\r\n        if len(parts) != 2:\r\n            yield event.plain_result(f\u0022格式错误，请使用 `/文章密码 文章ID` 格式。\u0022)\r\n            return\r\n        \r\n        command, post_id_str = parts\r\n        \r\n        # 检查 post_id 是否为数字\r\n        if not post_id_str.isdigit():\r\n            yield event.plain_result(f\u0022格式错误，请使用 `/文章密码 文章ID` 格式，文章ID必须是数字。\u0022)\r\n            return\r\n        \r\n        post_id = int(post_id_str.strip())\r\n        \r\n        if not post_id:\r\n            yield event.plain_result(f\u0022无效的文章ID，请重新输入。\u0022)\r\n            return\r\n        \r\n        # 构建API请求数据\r\n        data = {\r\n            \u0022api_token\u0022: self.api_token,\r\n            \u0022postid\u0022: post_id\r\n        }\r\n        \r\n        # 调用API获取密码\r\n        api_url = f\u0022{self.website_url}/wp-json/ngapi/v1/get-password\u0022\r\n        try:\r\n            response = requests.post(api_url, json=data)\r\n            response.raise_for_status()\r\n            data = response.json()\r\n            \r\n            # 统一返回 API 返回的消息内容\r\n            message = data[\u0022data\u0022].get(\u0022message\u0022, \u0022未知错误\u0022)\r\n            yield event.plain_result(f\u0022{message}\u0022)\r\n        \r\n        except requests.exceptions.HTTPError as e:\r\n            logger.error(f\u0022HTTP 错误: {e}\u0022)\r\n            try:\r\n                data = response.json()\r\n                message = data[\u0022data\u0022].get(\u0022message\u0022, \u0022未知错误\u0022)\r\n            except (ValueError, KeyError):\r\n                message = \u0022无法解析API响应\u0022\r\n            yield event.plain_result(f\u0022{message}\u0022)\r\n        except requests.exceptions.RequestException as e:\r\n            logger.error(f\u0022请求API时发生错误: {e}\u0022)\r\n            yield event.plain_result(f\u0022请求API时发生错误: {str(e)}\u0022)","_zaxu_highlight_code_content":"field_5e2dbbd5f2c08"},"mode":"auto"} /-->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">TG机器人</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>部分框架提供对接其他平台的功能 参考QQ机器人的对接方式</p>
<!-- /wp:paragraph -->
